<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- notesan font  -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap">

    <!-- font awesome cdn -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />


    <title>King Game</title>
    <style>

        :root {

            --game-card-width: 75px;

            --trash-card-width: 60px;
            --trash-card-height: var(--trash-card-width) * 6 / 5;

            /* --game-card-height: calc(var(--game-card-width) * 6 / 5); */
        }

        * {
            touch-action: manipulation;
            -webkit-user-select: none;
        }
        body {
            /* font-family: Arial, sans-serif; */
            font-family: 'Noto Sans JP', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            /* height: 100vh; */
            margin: 0;
            background-color: whitesmoke;
        }
        #app {
        }
        #app .inner{
            /* max-width: 95vw; */
            margin: 5vh auto;
        } 

        .input-modal{
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h2 {
            margin-top: 0;
            text-align: center;
        }
        .player-input {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .player-input input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .player-input button {
            background-color: #e74c3c;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            margin-left: 5px;
            cursor: pointer;
        }
        .add-button, .start-button {
            display: block;
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 4px;
            margin-top: 10px;
            cursor: pointer;

            background-color: #3498db;
            color: #fff;
        }
        .start-button {
            background-color: #2ecc71;
            color: #fff;
        }
        /* ---------------------------------------- */
        #gameArea {
            display: grid;
            /* grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr; */
            /* grid-template-columns: calc(33.33% - 8px) calc(33.33% - 8px) calc(33.33% - 8px); */
            grid-template-columns: repeat(3, 350px);
            grid-template-rows: calc(50% - 6px) calc(50% - 6px);
            gap: 12px;
            
            /* width: 95vw; */
            height: 90vh;

            max-width: 1150px;
            max-height: 750px;
            margin: auto;
        }

        #gameArea .grid-item{
            padding: 15px 10px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);

            border-color: grey;
            border-width: 5px;
            border-style: solid;

            transition: all .4s;

            display: flex;
            flex-direction: column;
            justify-content: space-between;

        }
        #gameArea .main-area {
            /* grid-column: 2 / 3;
            grid-row: 1 / 2; */
            padding: 20px;

            background-color: DarkSeaGreen;
        }
        /* .player-1 { grid-column: 1 / 2; grid-row: 2 / 3; }
        .player-2 { grid-column: 2 / 3; grid-row: 2 / 3; }
        .player-3 { grid-column: 3 / 4; grid-row: 2 / 3; }
        .player-4 { grid-column: 1 / 2; grid-row: 1 / 2; }
        .player-5 { grid-column: 3 / 4; grid-row: 1 / 2; } */

        #gameArea h3{
            /* text-align: ce; */
            margin: 0;
            line-height: 1;
            font-size: 1em;
            text-wrap: nowrap;
        }

        #gameArea .main-grid {
            display: grid;
            /* grid-template-columns: 2fr 1fr; */
            grid-template-columns: calc(60% - 10px) calc(40% - 10px);
            justify-content: space-between;

            align-items: start;
            /* gap: 20px; */
        }

    
        #gameArea .gameCard{
            display: flex;
            align-items: center;
            justify-content: center;

            margin: auto;
            
            width: var(--game-card-width);
            /* height: var(--game-card-height); */
            aspect-ratio: 5/6;

            border: 1px solid black;

            border-radius: 7.5px;
            overflow: hidden;
        }

        /* ----------------------------------------------------- */

        #gameArea .main-area .main-grid{
            height: 100%;
            /* overflow: hidden; */
        }

        #gameArea .main-area .main-grid > *{
            
            height: calc(100% - 30px);
        }

        #gameArea .main-area .trash-area{
            position: relative;
            background-color: burlywood;

            padding: 10px;

            border-color: grey;
            border-width: 5px;
            border-style: solid;

            border-radius: 8px;

            height: calc(100% - 30px);
        }

        #gameArea .main-area .trash-area h3{
            text-align: center;
            margin-bottom: 15px;
            line-height: 1.2;

            font-size: .9em;
        }

        #gameArea .main-area .main-trash-area{
            border-bottom-right-radius: 0;
            overflow: hidden;
        }

        

        #gameArea .main-area .main-trash-area .food-trash-container{
            display: grid;
            grid-template-columns: repeat(2,48%);
            justify-content: space-between;
        }

        #gameArea .main-area .trash-area .food-trash-container .card-block{
            position: relative;
            margin-bottom: 5px;
            
            text-align: center;

            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }


        #gameArea .main-area .trash-area .gameCard{
            display: block;
            margin: auto 0;
            width: 42.5px;
        }

        #gameArea .main-area .trash-area .food-trash-container .card-block span{
            font-size: .8em;
            text-wrap: nowrap;
        }

        #gameArea .main-area .main-info{
            display: flex;
            flex-direction: column;
            justify-content: space-between;

            text-align: center;

            height: 100% !important;
        }

        #gameArea .main-area .main-info .draw-pile-area .gameCard{
            margin: 10px auto;
        }

        /* ----------------------------------------------------- */

        #gameArea .main-area .main-info .other-trash-area{
            height: calc(60% - 40px) !important;

            width: calc(100% - -5px);
            transform: translateX(-25px);

            border-left: none;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;

            overflow: hidden;

            display: flex;
            flex-direction: column;
            justify-content: space-between;

        }

        #gameArea .main-area .main-info .other-trash-area h3{
            height: calc(15% - 5px);
            margin-bottom: unset;

            display: flex;
            align-items: center;
            justify-content: center;
        }

        #gameArea .main-area .main-info .other-trash-area .other-trash-area-container{
            position: relative;
            height: calc(85% - 5px);
            width: 100%;
            margin: auto auto 0;
        }

        #gameArea .main-area .main-info .other-trash-area .other-trash-area-container .gameCard{
            position: absolute;
            width: 50px;
        }
        /* ----------------------------------------------------- */


        #gameArea .player .main-grid .babies-info {
            display: grid;
            grid-template-columns: repeat(2, 48%);
            grid-gap: 10px;

            /* overflow: hidden; */
        }

        #gameArea .player .main-grid .baby-item {
            position: relative;

            display: flex;
            justify-content: center;
            align-items: center;
            
            border-width: 2.5px;
            border-style: dashed;
            aspect-ratio: 1/1;
        }

        #gameArea .player .main-grid .baby-item .baby-img-container{
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            border-radius: 50%;
            height: 80px;
            max-height: 85%;
            aspect-ratio: 4/5;
        }

        #gameArea .player .main-grid .baby-item .babbaby-grown-img-containeriner{
            overflow: hidden;
            width: 100%;
            aspect-ratio: 1;
        }

        #gameArea .player .main-grid .baby-item img {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #gameArea .player .main-grid .baby-item span {
            position: absolute;
            bottom: 0;
            right: 3px;

            font-size: 90%;
        }

        /* ----------------------------------------------------- */

        #gameArea .player .player-info{
            position: relative;
        }

        #gameArea .player .player-info .player-name {
            text-align: center;
        }

        #gameArea .player .player-info .player-img {
            width: 90%;
            aspect-ratio: 1;
            overflow: hidden;
            border-radius: 50%;
            margin: 15px auto;
        }

        #gameArea .player .player-info .king-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #gameArea .player .player-info .player-food {
            display: flex;
            /* flex-direction: column; */
            justify-content: center;
            align-items: flex-start;
            gap: 7.5px;
            text-align: center;

            font-size: 75%;
        }

        #gameArea .player .player-info .player-food img{
            display: block;
            width: 100%;
            margin-bottom: 5px;
        }

        #gameArea .player .bottom-section{
            position: relative;
            display: grid;
            grid-template-columns: calc(80% - 10px) calc(20% - 10px);
            justify-content: space-between;
            align-items: center;

            height: 90px;
        }

        #gameArea .player .bottom-section > * {
            height: 100%; /* Ensure each child takes the full height */
        }

        

        #gameArea .player .gameCard-container{
            display: block;
            margin: auto;

            
            position: relative;

            height: 100%;

            
        }

        #gameArea .player .gameCard{
            position: absolute;

            left: 0%;

            transition: all 0.5s ease-in-out;
        }

        #gameArea .player .gameCard:first-child{
            /* margin-left: unset !important; */
        }

        #gameArea .player .gameCard img{
            display: block;
            max-width: 100%;
        }

        #gameArea .player .gameCard span{
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #gameArea .player .bottom-section .info-area{
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #gameArea .player .bottom-section .info-area .eye-circle{
            display: flex;
            width: 20px;
            aspect-ratio: 1;

            align-items: center;
            justify-content: center;

            
            border: 2px solid black;
            border-radius: 50%;
        }
        
        #gameArea .player .bottom-section .info-area .eye-circle i{
            font-size: 15px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="inner">

            <div v-if="currentPage === 'before'">
                <div class="input-modal">
                    <h2>プレイヤー名を入力してください</h2>
                    <div v-for="(player, index) in players" :key="index" class="player-input">
                        <input type="text" v-model="player.name" placeholder="名前を入力">
                        <button @click="removePlayer(index)">x</button>
                    </div>
                    <button v-if="players.length < 5" @click="addPlayer" class="add-button">+</button>
                    <button v-if="readyToPlay" @click="goToGamePage" class="start-button">{{this.players.length}}人で遊ぶ</button>
                </div>
            </div>

            <div v-if="currentPage === 'game'">
                <div id="gameArea">

                    <div class="grid-item main-area">
                        <div class="main-grid">
                            <div class="trash-area main-trash-area">
                                <h3>食べ物ゴミ捨て場</h3>
                                <div class="food-trash-container">
                                    <template v-for="(group, index) in foodTrash" :key="index">
                                        <div class="card-block">
                                            <div class="gameCard" :style="getBackgroundColor(group[0])">
                                            </div>
                                            <span>x{{ group.length }}</span>
                                        </div>
                                    </template>
                                </div>
                                
                            </div>
                            <div class="main-info">
                                <div class="draw-pile-area">
                                    <h3>山札(<span>残り{{drawPile.length}}枚</span>)</h3>
                                    
                                    <img v-if="drawPile.length > 0" class="gameCard" src="./assets/image/card-back.png" @click="drawCard()">
                                    
                                </div>
                                <div class="trash-area other-trash-area">
                                    <h3>その他のゴミ</h3>
                                    <div class="other-trash-area-container">
                                        <template v-for="(card, index) in otherTrashPile" :key="card.id">
                                            <div
                                              class="gameCard"
                                              :style="[getBackgroundColor(card), getTrashPosition(card)]"
                                            >
                                              <span>{{ card.name }}</span>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                        
                        
                    </div>
                    
                    <div v-for="(player, index) in players" :key="index" :class="`grid-item player player-${index + 1}`" :style="[ { borderColor: player.color }, index !== currentPlayerIndex ? { backgroundColor: 'dimGray', opacity: '.75' } : {} ]">
                        <!-- Player content -->
                        <div class="main-grid">

                            <div class="babies-info">
                                <template v-for="(baby, babyIndex) in player.babies" :key="babyIndex">
                                    <div class="baby-item" :style="{borderColor: player.color}"  @click="feedBaby(baby, player)">
                                        <div :class="getClass(baby)"  :style="baby.foodArray.length == 2 ? '' : 'opacity: .5'">
                                            <img :src="baby.foodArray.length == 2 ? baby.kingImgSrc : baby.babyImgSrc" alt="Baby Image">
                                        </div>
                                        <span>x{{baby.foodArray.length}}</span>
                                    </div>
                                </template>
                            </div>

                            <div class="player-info">
                                <div class="player-name">
                                    <h3>{{ player.name }}</h3>
                                </div>
                                <div class="player-img">
                                    <img :src="player.king.imgSrc" alt="King Image" class="king-image">
                                </div>
                                <div class="player-food">
                                    <div v-if="food[player.king.foodRequirements[0]]">
                                        <img :src="food[player.king.foodRequirements[0]].imgSrc" alt="">{{ food[player.king.foodRequirements[0]].name }}
                                    </div>
                                    <div v-if="food[player.king.foodRequirements[1]]">
                                        <img :src="food[player.king.foodRequirements[1]].imgSrc" alt="">{{ food[player.king.foodRequirements[1]].name }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bottom-section">
                            <div>
                                <div v-if="!player.isRevealing || playerHands(player.name).length == 0">
                                    <div  class="gameCard">
                                        <img src="./assets/image/card-back.png" alt="">
                                    </div>
                                </div>
                                <div v-else class="gameCard-container">
                                    <template v-for="(card, index) in playerHands(player.name)" :key="card.id">
                                        <div
                                          class="gameCard"
                                          :style="[getBackgroundColor(card), calculateCardPosition(index, playerHands(player.name).length)]"
                                        >
                                          <span>{{ card.name }}</span>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <div class="info-area" v-if="gameStatus == 'distributed'">
                                
                                <span>{{ playerHands(player.name).length }}枚</span>
                                <div v-if="player.name == currentPlayer.name" class="eye-circle" @click="player.isRevealing = !player.isRevealing">
                                    <i :class="['fa-solid', player.isRevealing ? 'fa-eye' : 'fa-eye-slash']"></i>
                                </div>
                            </div>
                        </div>
                        
                        
                    </div>
                    
                </div>
            </div>

        </div>
    </div>

    
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
    <script type="module">
        // import { randomNames } from './name.js';
        const app = Vue.createApp({
            data() {
                return {
                    developingMode: true,
                    defaultNumber: 2,

                    currentPage: 'before',
                    gameStatus: 'waiting',

                    players: [],
                    currentPlayerIndex: 0,
                    
                    teamColors: ['#DC143C', '#0047AB', '#228B22', '#FFD700', '#1C1C1C'],
                    cardsPerPlayer : 5,


                    randomNames:[
                        'あきなす',
                        'アケオメ',
                        'あすなろ',
                        'あと１ぽん',
                        'あなご',
                        'アニ',
                        'あろあろ',
                        'あんぱん',
                        'イカフライ',
                        'いただき',
                        'いやいや',
                        'うぃー',
                        'ウエルカム',
                        'ウキャキャ',
                        'うすくち',
                        'うっとり',
                        'えっへん',
                        'えぴ',
                        'おおあたり',
                        'おおとろ',
                        'おかん',
                        'おさきです',
                        'おならプー',
                        'かいがん',
                        'カクテキ',
                        'カターカタ',
                        'かちょう',
                        'ガニ',
                        'かまくら',
                        'からすみ',
                        'からてか',
                        'かるしうむ',
                        'キャメロン',
                        'グェ',
                        'くっちゃね',
                        'ぐらま～',
                        'ぐらんぱ',
                        'くるとん',
                        'くろおび',
                        'ゲジゲジ',
                        'ごっつあん',
                        'ことこと',
                        'ごはん',
                        'サラミ',
                        'さんかく',
                        'サンチュ',
                        'シェフ',
                        'しおしお',
                        'しこみ',
                        'しめさば',
                        'じゃんぼ',
                        'しらたき',
                        'すなぎも',
                        'スベスベ',
                        'センス',
                        'そばゆ',
                        'そら',
                        'っょぃゃっ',
                        'つんつん',
                        'ツンドラ',
                        'ていおう',
                        'デスポッド',
                        'ですます',
                        'てっかまき',
                        'てばさき',
                        'てふてふ',
                        'テミヤゲ',
                        'でろでろ',
                        'とんかつ',
                        'とんこつ',
                        'トンズラ',
                        'ナイスガイ',
                        'なにがし',
                        'ナポリタン',
                        'ニイハオ',
                        'にとうへい',
                        'にんにくん',
                        'ねるねる',
                        'ハード',
                        'はかばか',
                        'ハロー',
                        'はんぺん',
                        'ヒエン',
                        'ピカピカ',
                        'ビギナー',
                        'ヒットミー',
                        'ぶぅぅぅん',
                        'ふぉぉぉぉ',
                        'へっぽこ',
                        'ポ',
                        'ぽりごん',
                        'ポリスマン',
                        'ぼるしち',
                        'ぼんじり',
                        'まえうしろ',
                        'マエストロ',
                        'ましかく',
                        'まじかる',
                        'マゼラン',
                        'マタドール',
                        'マヨラー',
                        'まんまる',
                        'まんもす',
                        'メロリン',
                        'モケモケ',
                        'もずくす',
                        'もみあげ',
                        'もろへいや',
                        'ヤヤ',
                        'ゆたんぽ',
                        'ゆでたまご',
                        'よろしく',
                        'ラスいち',
                        'ラッキー',
                        'りもこん',
                    ],

                    kings:[
                        {name:'クマ', imgSrc:'./assets/image/bear.jpg', foodRequirements: [0,1]},
                        {name:'オオワシ', imgSrc:'./assets/image/eagle.jpg', foodRequirements: [1,2]},
                        {name:'シャチ', imgSrc:'./assets/image/orca.jpg', foodRequirements: [1,3]},
                        {name:'キタキツネ', imgSrc:'./assets/image/fox.jpg', foodRequirements: [0,4]},
                        {name:'タンチョウヅル', imgSrc:'./assets/image/crane.jpg', foodRequirements: [1,4]},
                    ],

                    food:[
                        {name:'果物',imgSrc: './assets/image/food-1.jpg'},
                        {name:'魚',imgSrc: './assets/image/food-2.jpg'},
                        {name:'ねずみ',imgSrc: './assets/image/food-3.jpg'},
                        {name:'いか',imgSrc: './assets/image/food-4.jpg'},
                        {name:'虫',imgSrc: './assets/image/food-5.jpg'},
                    ],

                    energy:[
                        {name:'エネルギー1',imgSrc: './assets/image/energy-1.jpg'},
                        {name:'エネルギー2',imgSrc: './assets/image/energy-2.jpg'},
                        {name:'エネルギー3',imgSrc: './assets/image/energy-3.jpg'},
                        {name:'エネルギー4',imgSrc: './assets/image/energy-4.jpg'},
                        {name:'エネルギー5',imgSrc: './assets/image/energy-5.jpg'},
                    ],

                    obstacle:[
                        {name:'障害1',imgSrc: './assets/image/obstacle-1.jpg'},
                        {name:'障害2',imgSrc: './assets/image/obstacle-2.jpg'},
                        {name:'障害3',imgSrc: './assets/image/obstacle-3.jpg'},
                        {name:'障害4',imgSrc: './assets/image/obstacle-4.jpg'},
                        {name:'障害5',imgSrc: './assets/image/obstacle-5.jpg'},
                        {name:'障害6',imgSrc: './assets/image/obstacle-6.jpg'},
                        {name:'障害7',imgSrc: './assets/image/obstacle-7.jpg'},
                        {name:'障害8',imgSrc: './assets/image/obstacle-8.jpg'},
                    ],

                    deck:[],

                };
            },
            computed: {
                readyToPlay() {
                    const namePattern = /^[^\s!@#$%^&*(),.?":{}|<>]+$/;
                    const uniquerandomNames = new Set(this.players.map(player => player.name.trim()));
                    
                    return this.players.length >= 2 &&
                        this.players.length <= 5 &&
                        uniquerandomNames.size === this.players.length &&
                        this.players.every(player => 
                            player.name.trim() !== '' && 
                            namePattern.test(player.name)
                        );
                },

                currentPlayer() {
                    return this.players[this.currentPlayerIndex];
                },

                drawPile() {
                    return this.deck.filter(card => card.location === 'drawPile');
                },

                trashPile() {
                    return this.deck.filter(card => card.location === 'trash');
                },
                foodTrash() {
                    const foodTrash = this.deck.filter(card => card.location === 'trash' && card.type === 'food');
                    const groupedByName = foodTrash.reduce((acc, card) => {
                        if (!acc[card.name]) {
                            acc[card.name] = [];
                        }
                        acc[card.name].push(card);
                        return acc;
                    }, {});
                    return Object.values(groupedByName);
                },
                otherTrashPile() {
                    return this.deck
                        .filter(card => card.location === 'trash' && card.type !== 'food')
                        .sort((a, b) => new Date(a.updatedAt) - new Date(b.updatedAt)); // Reverse order
                },


                playerHands() {
                    return playerName => this.deck.filter(card => card.location === playerName);
                },
            },
            watch: {
                drawPile(newVal) {
                    if(this.gameStatus !== 'distributed') return
                    if (newVal.length === 0) {
                        this.gameStatus = 'ended'
                        alert('The draw pile is empty!');
                    }
                },
                players: {
                    handler(newVal) {
                        newVal.forEach(player => {
                        const allBabiesFed = player.babies.every(baby => baby.foodArray.length === 2);
                        if (allBabiesFed) {
                            alert(`Game over for ${player.name}!`);
                            this.gameStatus = 'ended';
                        }
                        });
                    },
                    deep: true
                },
            },
            methods: {
                sleep(ms) {
                    return new Promise(resolve => setTimeout(resolve, ms));
                },
                getRandomName() {
                    let randomName;
                    do {
                        const randomIndex = Math.floor(Math.random() * this.randomNames.length);
                        randomName = this.randomNames[randomIndex];
                    } while (this.players.some(player => player.name === randomName));
                    return randomName;
                },
                addPlayer() {
                    const randomName = this.getRandomName();
                    this.players.push({ name: randomName });
                },
                removePlayer(index) {
                    this.players.splice(index, 1);
                },
                shuffleArray(array) {
                    for (let i = array.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [array[i], array[j]] = [array[j], array[i]];
                    }
                },
                
                goToGamePage() {
                    if (!this.readyToPlay) return;

                    // Shuffle and assign colors
                    this.gameStatus = 'waiting'
                    this.shuffleArray(this.teamColors);
                    this.shuffleArray(this.kings);
                    this.players.forEach((player, index) => {
                        player.color = this.teamColors[index];
                        player.king = this.kings[index];

                        player.babies = []

                        player.isRevealing = false

                        // Generate baby image source
                        const kingImgSrc = this.kings[index].imgSrc;
                        const fileName = kingImgSrc.substring(kingImgSrc.lastIndexOf('/') + 1, kingImgSrc.lastIndexOf('.'));
                        const fileExtension = kingImgSrc.substring(kingImgSrc.lastIndexOf('.'));
                        const babyImgSrc = `./assets/image/${fileName}-baby${fileExtension}`;

                        // Push the baby object 5 times
                        for (let i = 0; i < 4; i++) {
                            player.babies.push({
                                kingImgSrc,
                                babyImgSrc,
                                isBlocked: false,
                                foodArray: [],
                            });
                        }
                    });

                    // create the deck
                    this.initializeDeck();



                    // Reset the current player index
                    this.currentPlayerIndex = 0;

                    this.currentPage = 'game';
                },
                startGame(){
                    this.gameStatus = 'shuggling'

                    this.shuffleArray(this.deck)

                    this.gameStatus = 'shuffled'
                },
                initializeDeck() {
                    this.deck = [];

                    const createNameIndexContainer = (counts) => {
                        return counts.flatMap((count, index) => Array(count).fill(index));
                    };

                    const types = [
                        {
                            type: 'food',
                            nameIndexContainer: createNameIndexContainer([8, 8, 7, 7, 8])
                        },
                        {
                            type: 'energy',
                            nameIndexContainer: createNameIndexContainer([2, 2, 2, 2, 2])
                        },
                        {
                            type: 'obstacle',
                            nameIndexContainer: createNameIndexContainer([2, 2, 2, 2, 2, 2, 2, 2])
                        }
                    ];

                    const dataMap = {
                        food: this.food,
                        energy: this.energy,
                        obstacle: this.obstacle
                    };

                    let id = 1;

                    types.forEach(({ type, nameIndexContainer }) => {
                        nameIndexContainer.forEach(nameIndex => {
                            const currentData = dataMap[type][nameIndex];

                            this.deck.push({
                                id: id++,
                                type: type,
                                name: currentData?.name,
                                imgSrc: currentData?.imgSrc, // Assuming imgSrc is part of your data
                                location: 'drawPile',
                                description: ''
                            });
                        });
                    });
                },
                async distributeCards() {
                    this.gameStatus = 'distributing'
                    if (this.drawPile.length !== this.deck.length) return;

                    for (let i = 0; i < this.cardsPerPlayer; i++) {
                        for (let player of this.players) {
                            const card = this.drawPile[0];
                            if (card) {
                                // console.log(`Distributing ${card.id} to ${player.name}`);
                                card.location = player.name;
                                await this.sleep(20); // Add delay if needed
                            }
                        }
                    }

                    this.gameStatus = 'distributed'
                },
                getRandomCardFromDeck() {
                    const availableCards = this.drawPile;
                    const randomIndex = Math.floor(Math.random() * availableCards.length);
                    return availableCards[randomIndex];
                },
                drawCard(){
                    if(this.gameStatus !== 'distributed' || !this.drawPile[0]) return
                    if(!this.playerHands(this.playerHands(this.currentPlayer.name[0])))return

                    this.trashCard(this.playerHands(this.currentPlayer.name)[0])
                    this.drawPile[0].location = this.currentPlayer.name
                    
                    this.goToNextPlayer()
                },
                trashCard(card){
                    card.location = 'trash'
                    card.updatedAt = Date.now();
                    
                    const verticalPosition = (Math.random() * 51);
                    const horizontalPosition = (Math.random() * 51);

                    card.verticalPosition = Math.random() < 0.5 ? `top: ${verticalPosition}%;` : `bottom: ${verticalPosition}%;`;
                    card.horizontalPosition = Math.random() < 0.5 ? `left: ${horizontalPosition}%;` : `right: ${horizontalPosition}%;`;

                    const maxDeg = 45;
                    card.rotation = Math.round(Math.random() * maxDeg - (maxDeg / 2));

                    console.log(card.rotation);


                },
                goToNextPlayer() {
                    // Move to the next player, wrapping around if necessary
                    this.currentPlayer.isRevealing = false
                    this.currentPlayerIndex = (this.currentPlayerIndex + 1) % this.players.length;
                },
                feedBaby(baby,player){
                    if(this.gameStatus !== 'distributed') return
                    if(this.currentPlayer.name !== player.name) return
                    if(baby.foodArray.length == 2) return
                    

                    baby.foodArray.push(this.food[0])
                },
                getClass(baby) {
                    let className = 'baby-img-container';
                    if (baby.foodArray.length == 2) {
                        className = 'baby-grown-img-container';
                    }
                    return className;
                },
                getBackgroundColor(card){
                    let color

                    switch(card.type){
                        case  'food' : 
                            color = 'HotPink';
                            break;

                        case  'energy' : 
                            color = 'yellow';
                            break;

                        case  'obstacle' : 
                            color = 'Chocolate';
                            break;
                    
                        default :
                            color = 'black';
                            break;
                    }

                    return { backgroundColor: color };

                },
                calculateCardPosition(index, totalCards) {
                    const percentage = (100 / (totalCards - 1)) * index;

                    return {
                        // position: 'absolute',
                        left: `${percentage}%`,
                        transform: `translateX(-${percentage}%)` // Adjust for overlap
                    };
                },
                getTrashPosition(card) {
                    return `transform: rotate(${card?.rotation}deg); ${card.verticalPosition} ${card.horizontalPosition}`;
                },
                
            },
            async mounted(){


                let lastTouchEnd = 0;
                document.addEventListener('touchend', function(event) {
                let now = new Date().getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
                }, false);


                

                if(this.developingMode){
                    for (let i = 0; i < this.defaultNumber; i++) {
                        this.addPlayer();
                    }

                    this.goToGamePage()
                }

                await this.sleep(250)
                this.startGame()

                
                await this.sleep(250)
                await this.distributeCards()

                if(this.developingMode){
                    for (let i = 0; i < 50; i++) {
                        this.drawCard()
                        await this.sleep(25)
                    }
                }
                
            },
        });


        app.mount('#app');
    </script>
</body>
</html>
